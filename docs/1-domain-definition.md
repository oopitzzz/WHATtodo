# WHATtodo 도메인 정의서

## 1. 프로젝트 개요
WHATtodo는 사용자 인증 기반의 할일 관리 애플리케이션입니다. 사용자는 개인의 할일을 체계적으로 관리하고, 캘린더와 연동하여 일정을 효율적으로 추적할 수 있습니다.

## 2. 용어 사전

| 용어 | 정의 |
|-----|------|
| **할일(Todo)** | 사용자가 완료해야 할 작업 항목 |
| **우선순위** | 할일의 중요도를 나타내는 지표 (높음/보통/낮음) |
| **마감일** | 할일을 완료해야 하는 목표 날짜 |
| **휴지통** | 삭제된 할일이 30일간 임시 보관되는 공간 (복원 가능) |
| **활성(ACTIVE)** | 진행 중인 할일의 상태 |
| **완료(COMPLETED)** | 완료된 할일의 상태 |
| **삭제됨(DELETED)** | 휴지통으로 이동된 할일의 상태 |
| **공휴일** | 국가 또는 공식 휴무일로 캘린더에 표시되는 날짜 |

## 3. 핵심 도메인 엔티티

### 3.1 User (사용자)
사용자 계정 및 프로필 정보를 관리하는 엔티티입니다.

**속성:**
- 사용자 ID (UUID, 고유 식별자)
- 이메일 (String, 로그인 ID)
- 비밀번호 (String, 암호화 저장)
- 닉네임 (String)
- 프로필 사진 (String, URL 또는 파일 경로)
- 알림 활성화 여부 (Boolean, 기본값: true)
- 가입일 (DateTime)
- 최종 로그인 일시 (DateTime)

**제약조건:**
- 이메일은 고유해야 함 (UNIQUE)
- 이메일은 유효한 형식이어야 함
- 닉네임은 2~20자 이내
- 모든 앱 기능은 로그인 후 사용 가능

**관계:**
- User 1 : N Todo
- User 1 : N Notification

### 3.2 Todo (할일)
사용자의 할일 항목을 나타내는 핵심 엔티티입니다.

**속성:**
- 할일 ID (UUID, 고유 식별자)
- 사용자 ID (UUID, 외래키)
- 제목 (String, 필수, 최대 100자)
- 설명 (Text, 선택사항)
- 우선순위 (Enum: HIGH, NORMAL, LOW)
- 마감일 (DateTime, 선택사항)
- 상태 (Enum: ACTIVE, COMPLETED, DELETED)
- 메모 (Text, 선택사항)
- 생성일 (DateTime)
- 수정일 (DateTime)
- 완료일 (DateTime, nullable)

**제약조건:**
- 각 할일은 반드시 한 명의 사용자에게 속함
- 제목은 필수 항목 (NOT NULL)
- 우선순위 기본값: NORMAL
- 상태 기본값: ACTIVE
- 삭제된 할일은 휴지통에 30일간 보관

**관계:**
- Todo N : 1 User
- Todo 1 : N Notification

### 3.3 Calendar (캘린더)
공휴일 및 날짜 참조 데이터를 관리하는 엔티티입니다. 사용자별 데이터가 아닌 시스템 공통 데이터입니다.

**속성:**
- 날짜 (Date, 고유 식별자)
- 공휴일 여부 (Boolean)
- 공휴일 명칭 (String, nullable)
- 연도 (Integer)
- 월 (Integer, 1~12)
- 주차 (Integer, 1~53)
- 요일 (Enum: MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY)

**제약조건:**
- 날짜는 고유해야 함 (PRIMARY KEY)

**관계:**
- 독립 엔티티 (참조 데이터)

### 3.4 Notification (알림)
사용자에게 전송되는 푸시 알림 정보입니다.

**속성:**
- 알림 ID (UUID, 고유 식별자)
- 사용자 ID (UUID, 외래키)
- 할일 ID (UUID, 외래키)
- 알림 유형 (Enum: DEADLINE_D_MINUS_1, DEADLINE_D_DAY)
- 발송 예정 시각 (DateTime)
- 발송 여부 (Boolean, 기본값: false)
- 생성일 (DateTime)

**제약조건:**
- 각 알림은 반드시 한 명의 사용자와 한 개의 할일에 속함
- 발송 예정 시각은 미래 시점이어야 함

**관계:**
- Notification N : 1 User
- Notification N : 1 Todo

## 4. 주요 기능

### 4.1 사용자 관리 [관련 엔티티: User]
- 회원가입
- 로그인/로그아웃
- 프로필 수정 (닉네임, 프로필 사진)
- 알림 ON/OFF 설정

### 4.2 할일 관리 [관련 엔티티: User, Todo, Notification]
- 할일 추가
- 할일 조회 (월/주/일 단위)
- 할일 수정
- 할일 삭제 (휴지통 이동)
- 할일 완료 처리
- 완료 취소 (완료 → 활성)
- 우선순위 설정
- 마감일 설정
- 메모 추가/수정

### 4.3 일정 관리 [관련 엔티티: Todo, Calendar]
- 월간 캘린더 뷰
- 주간 캘린더 뷰
- 일간 캘린더 뷰
- 공휴일 표시

### 4.4 알림 관리 [관련 엔티티: User, Notification]
- 마감일 임박 시 푸시 알림
- 알림 전체 ON/OFF 설정

### 4.5 데이터 관리 [관련 엔티티: Todo]
- 완료된 할일 목록 조회
- 휴지통에서 할일 복원
- 휴지통에서 할일 영구 삭제

## 5. 비즈니스 규칙

### 5.1 인증 규칙
- 모든 앱 기능은 로그인된 사용자만 접근 가능
  - **검증:** JWT 토큰, access_token, refresh_token 함께 사용.
- 사용자는 자신의 할일만 조회/수정/삭제 가능
  - **검증:** Todo.사용자ID = 현재 로그인 사용자ID

### 5.2 할일 상태 규칙

```
ACTIVE (활성) ──체크박스 체크──→ COMPLETED (완료)
      │                              │
      │                              └──체크 해제──→ ACTIVE (다시 활성)
      │
      └──삭제 버튼──→ DELETED (삭제됨)
                          │
                          └──복원 체크박스──→ ACTIVE (다시 활성)
```

- 완료된 할일(COMPLETED)도 다시 체크 해제하여 ACTIVE로 변경 가능
- 삭제된 할일(DELETED)은 휴지통에서 30일간 보관
- 30일 경과 후 자동으로 영구 삭제
- 완료된 할일은 별도 목록에서 필터링하여 조회
  - **검증:** SELECT * FROM Todo WHERE status = 'COMPLETED'
- 삭제된 할일은 휴지통에 보관되며 복원 가능
  - **검증:** SELECT * FROM Todo WHERE status = 'DELETED' AND DATEDIFF(NOW(), 수정일) <= 30

### 5.3 알림 규칙
- 마감일이 설정된 할일에 한해 알림 생성
  - **검증:** Todo.마감일 IS NOT NULL
- 알림 발송 시점:
  - **D-1**: 마감일 하루 전 오전 9시
  - **D-day**: 마감일 당일 오전 9시
  - **검증:** 발송예정시각 = 마감일 - 1일 09:00 OR 마감일 09:00
- 사용자는 알림 ON/OFF 설정 가능 (전체)
  - **검증:** User.알림활성화여부 = true일 때만 알림 발송
- 이미 완료(COMPLETED) 또는 삭제(DELETED)된 할일은 알림 발송 안 함
  - **검증:** Todo.상태 = 'ACTIVE'인 경우에만 알림 발송

### 5.4 우선순위 규칙
- 우선순위: HIGH(높음) > NORMAL(보통) > LOW(낮음)
- 같은 날짜의 할일은 우선순위 순으로 정렬
  - **검증:** ORDER BY 마감일 ASC, 우선순위 DESC

### 5.5 캘린더 규칙
- 공휴일 정보는 외부 API 또는 데이터베이스에서 조회
- 월/주/일 단위 뷰 전환 가능
- 캘린더에는 ACTIVE 및 COMPLETED 상태의 할일만 표시 (DELETED 제외)

## 6. 핵심 프로세스

### 6.1 할일 생성 프로세스
1. 사용자가 할일 정보 입력 (제목, 설명, 우선순위, 마감일 등)
   - **검증:** 제목은 필수, 최대 100자
2. 시스템이 할일 저장 (상태: ACTIVE)
3. 마감일이 있는 경우, 알림 2개 생성 (D-1 오전 9시, D-day 오전 9시)
   - **검증:** 마감일 IS NOT NULL
4. TodoCreated 이벤트 발생

### 6.2 할일 완료 프로세스
1. 사용자가 체크박스 클릭
2. 할일 상태를 COMPLETED로 변경
3. 완료일 기록 (현재 시각)
4. 관련 알림 비활성화 (발송 예정인 알림 삭제 또는 상태 변경)
5. TodoCompleted 이벤트 발생

### 6.3 할일 삭제 프로세스
1. 사용자가 삭제 버튼 클릭
2. 할일 상태를 DELETED로 변경
3. 수정일 업데이트 (삭제 시점 기록)
4. 관련 알림 비활성화
5. TodoDeleted 이벤트 발생

### 6.4 휴지통 복원 프로세스
1. 사용자가 휴지통 화면 진입
2. 복원할 할일의 복원 체크박스 클릭
3. 할일 상태를 ACTIVE로 변경
4. 마감일이 남아있으면 알림 재생성
   - **검증:** 마감일 >= 현재 날짜
5. TodoRestored 이벤트 발생

### 6.5 알림 발송 프로세스
1. 시스템이 매일 정해진 시각(예: 오전 9시)에 알림 스케줄러 실행
2. 발송 예정 시각이 도래한 알림 조회
   - **검증:** 발송예정시각 <= 현재시각 AND 발송여부 = false
3. 할일 상태가 ACTIVE인지 확인
   - **검증:** Todo.상태 = 'ACTIVE'
4. 사용자 알림 설정 확인
   - **검증:** User.알림활성화여부 = true
5. 조건 충족 시 푸시 알림 발송
6. 발송 완료 여부 업데이트 (발송여부 = true)
7. DeadlineApproaching 이벤트 발생

### 6.6 휴지통 자동 정리 프로세스
1. 시스템이 매일 정해진 시각(예: 자정)에 배치 작업 실행
2. 삭제 후 30일이 경과한 할일 조회
   - **검증:** status = 'DELETED' AND DATEDIFF(NOW(), 수정일) > 30
3. 해당 할일 영구 삭제 (물리 삭제)
4. 관련 알림도 함께 삭제
5. TodoPermanentlyDeleted 이벤트 발생

## 7. 예외 상황 및 경계 조건

### 7.1 마감일 관련
- **과거 마감일 입력**: 경고 메시지 표시, 단 저장은 허용
- **마감일 없는 할일**: 알림 미생성, 캘린더 뷰에서는 우선순위 순으로만 표시
- **마감일이 지난 할일**: "지연됨" 표시, 알림은 발송되지 않음

### 7.2 상태 전환 관련
- **완료된 할일 → 활성**: 허용됨, 완료일은 null로 변경
- **삭제된 할일 → 활성**: 휴지통에서 복원 시에만 가능, 일반 목록에서는 불가
- **완료된 할일 삭제**: 가능, COMPLETED → DELETED
- **삭제된 할일 완료**: 불가, 먼저 복원 후 완료 처리

### 7.3 휴지통 관련
- **보관 기간**: 삭제 후 30일
- **30일 경과 후**: 자동 영구 삭제 (복원 불가)
- **복원 가능 기간**: 삭제 후 30일 이내

### 7.4 알림 관련
- **사용자 알림 OFF 상태**: 알림 생성은 되나 발송하지 않음
- **중복 알림 방지**: 동일 할일, 동일 유형, 동일 발송 시각의 알림은 1개만 생성
- **발송 실패**: 최대 3회 재시도, 실패 시 로그 기록

### 7.5 데이터 유효성
- **제목 길이**: 1~100자
- **닉네임 길이**: 2~20자
- **이메일 형식**: 표준 이메일 정규식 검증
- **우선순위**: HIGH, NORMAL, LOW 외의 값 불가
- **상태**: ACTIVE, COMPLETED, DELETED 외의 값 불가

## 8. 도메인 이벤트

### 8.1 TodoCreated
- **발생 시점:** 할일 생성 완료 시, 휴지통 복원 시
- **이벤트 데이터:** 할일 ID, 사용자 ID, 생성일
- **후속 처리:** 알림 생성, 통계 업데이트

### 8.2 TodoCompleted
- **발생 시점:** 할일 완료 처리 시
- **이벤트 데이터:** 할일 ID, 사용자 ID, 완료일
- **후속 처리:** 알림 비활성화, 완료 통계 업데이트

### 8.3 TodoDeleted
- **발생 시점:** 할일 삭제 (휴지통 이동) 시
- **이벤트 데이터:** 할일 ID, 사용자 ID, 삭제일
- **후속 처리:** 알림 비활성화

### 8.4 TodoRestored
- **발생 시점:** 휴지통에서 복원 시
- **이벤트 데이터:** 할일 ID, 사용자 ID, 복원일
- **후속 처리:** 알림 재생성 (마감일이 미래인 경우)

### 8.5 DeadlineApproaching
- **발생 시점:** 마감일 알림 발송 시
- **이벤트 데이터:** 할일 ID, 사용자 ID, 알림 유형, 발송 시각
- **후속 처리:** 푸시 알림 전송, 발송 이력 기록

### 8.6 TodoPermanentlyDeleted
- **발생 시점:** 휴지통에서 30일 경과 후 영구 삭제 시
- **이벤트 데이터:** 할일 ID, 사용자 ID, 영구 삭제일
- **후속 처리:** 관련 알림 삭제, 로그 기록

## 9. 요구사항 추적 매트릭스

| 원본 요구사항 | 관련 엔티티 | 관련 기능 | 비즈니스 규칙 | 프로세스 |
|------------|-----------|---------|-------------|---------|
| 월/주/일 단위 일정 관리 | Todo, Calendar | 4.3 일정 관리 | 5.5 캘린더 규칙 | - |
| 할일 추가/수정/삭제 | User, Todo | 4.2 할일 관리 | 5.2 할일 상태 규칙 | 6.1, 6.3 |
| 할일 우선순위 설정 | Todo | 4.2 할일 관리 | 5.4 우선순위 규칙 | 6.1 |
| 마감일 설정 | Todo | 4.2 할일 관리 | 5.3 알림 규칙 | 6.1 |
| 캘린더 연동 (공휴일) | Calendar | 4.3 일정 관리 | 5.5 캘린더 규칙 | - |
| 회원가입/로그인 | User | 4.1 사용자 관리 | 5.1 인증 규칙 | - |
| 메모 기능 | Todo | 4.2 할일 관리 | - | 6.1 |
| 푸시 알림 (마감일 임박) | Notification, Todo, User | 4.4 알림 관리 | 5.3 알림 규칙 | 6.5 |
| 완료된 할일 별도 관리 | Todo | 4.5 데이터 관리 | 5.2 할일 상태 규칙 | 6.2 |
| 삭제된 할일 휴지통 보관 | Todo | 4.5 데이터 관리 | 5.2 할일 상태 규칙 | 6.3, 6.4, 6.6 |
| 사용자 프로필 관리 | User | 4.1 사용자 관리 | - | - |
| 인증 기반 앱 이용 | User | 4.1 사용자 관리 | 5.1 인증 규칙 | - |

## 10. 기술적 고려사항

### 10.1 데이터 보안
- 비밀번호는 암호화하여 저장
- 사용자 세션 관리 필요

### 10.2 성능
- 할일 목록 조회 시 페이지네이션 또는 무한 스크롤
- 캘린더 뷰는 필요한 기간의 데이터만 조회
- 인덱스 설정: User.이메일, Todo.사용자ID, Todo.상태, Todo.마감일

### 10.3 확장성
- 향후 팀 단위 할일 관리 기능 추가 가능성 고려
- 태그, 카테고리 기능 추가 가능성 고려
- 반복 일정 기능 추가 가능성 고려

## 11. 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|-----|------|---------|--------|
| 2.0 | 2025-11-25 | - 데이터 타입 명시<br>- 용어 사전 추가<br>- 알림 설정 속성 추가<br>- 프로세스 정의 추가<br>- 도메인 이벤트 추가<br>- 요구사항 추적 매트릭스 추가<br>- 예외 상황 및 경계 조건 정의<br>- 상태 용어 통일 (ACTIVE, COMPLETED, DELETED) | Domain Expert |
| 1.0 | 2025-11-25 | 초안 작성 | Domain Expert |

---

**최종 수정일:** 2025-11-25
**버전:** 2.0
**작성자:** Domain Expert (with Claude Code)
