
  π“‹ μƒμ„Έ μ κ²€ λ‚΄μ©

  1οΈβƒ£ λ“λΌμ΄λ²„ λ λ²¨

  β… pg ν¨ν‚¤μ§€ (^8.16.3)
  - PostgreSQL κ³µμ‹ λ…Έλ“ λ“λΌμ΄λ²„ μ‚¬μ©
  - Supabaseλ” λ‚΄λ¶€μ μΌλ΅ 100% νΈν™μ„± μλ” PostgreSQL μ κ³µ    
  - κ²°λ΅ : λ“λΌμ΄λ²„ κµμ²΄ λ¶ν•„μ”

  2οΈβƒ£ μ—°κ²° κµ¬μ„± (backend/_lib/db.js)

  const pool = new Pool({
    connectionString:
  process.env.POSTGRES_CONNECTION_STRING,
    ssl: process.env.NODE_ENV === 'production' ? {
  rejectUnauthorized: false } : false,
    max: 20,
    idleTimeoutMillis: 30000,
    connectionTimeoutMillis: 2000,
  });

  νΈν™μ„± μ κ²€:
  - β… ν‘μ¤€ PostgreSQL μ—°κ²° λ¬Έμμ—΄ μ§€μ›
  - β… SSL μ„¤μ • (Supabaseλ” λ°λ“μ‹ SSL ν•„μ” β†’ ν”„λ΅λ•μ…μ—μ„    
   λ™μ‘)
  - β… μ»¤λ„¥μ… ν’€ μ„¤μ • (ν‘μ¤€ pg λΌμ΄λΈλ¬λ¦¬ λ°©μ‹)
  - β… DNS μ„¤μ • (test-connection.jsμ—μ„ IPv4 μ°μ„  μ„¤μ •)       

  3οΈβƒ£ SQL λ¬Έλ²• νΈν™μ„±

  μ‚¬μ© μ¤‘μΈ PostgreSQL κΈ°λ¥λ“¤:

  | κΈ°λ¥                | μ‚¬μ© μ²                 |
  PostgreSQL | Supabase | μƒνƒ  |
  |-------------------|----------------------|------------    
  |----------|-----|
  | UUID νƒ€μ…           | users.user_id        | β…
     | β…        | νΈν™  |
  | ENUM νƒ€μ…           | priority, status     | β…
     | β…        | νΈν™  |
  | ILIKE (λ€μ†λ¬Έμ λ¬΄μ‹)   | todoRepository.js:37 | β…       
         | β…        | νΈν™  |
  | CURRENT_TIMESTAMP | μ „μ²΄                   | β…
     | β…        | νΈν™  |
  | λ§¤κ°λ³€μ λ°”μΈλ”© ($1, $2) | μ „μ²΄                   | β…    
            | β…        | νΈν™  |
  | μΈλ±μ‹±               | μ „μ²΄                   | β…        
        | β…        | νΈν™  |

  4οΈβƒ£ μ €μ¥μ† λ μ΄μ–΄ νΈν™μ„±

  // userRepository.js, todoRepository.js,
  calendarRepository.js
  const { pool } = require('../db');
  let activePool = pool;

  function setPool(customPool) {
    activePool = customPool || pool;
  }

  await activePool.query(query, values);

  νΈν™μ„± νΉμ§•:
  - β… ν’€ μ¶”μƒν™”: ν…μ¤νΈμ© μ»¤μ¤ν…€ ν’€ μ£Όμ… κ°€λ¥
  - β… PostgreSQL API μ§μ ‘ μ‚¬μ©
  - β… Supabaseλ” ν‘μ¤€ PostgreSQL λ“λΌμ΄λ²„ νΈν™

  5οΈβƒ£ ν„μ¬ μ„¤μ • μƒνƒ

  backend/test-connection.jsμ—μ„ ν™•μΈ:
  - Supabase μ—°κ²° μ£Όμ†:
  db.dqhvtmphokkfocxeyjur.supabase.co:5432
  - DNS μ„¤μ •: IPv4 μ°μ„ 
  (dns.setDefaultResultOrder('ipv4first'))

  ---
  β οΈ μ£Όμμ‚¬ν•­

  1. SSL μ„¤μ •

  ssl: process.env.NODE_ENV === 'production' ? {
  rejectUnauthorized: false } : false,
  - λ΅μ»¬ κ°λ°: SSL λΉ„ν™μ„±ν™” β…
  - Supabase ν”„λ΅λ•μ…: SSL ν•„μ β…
  - λ΅μ»¬ PostgreSQL ν”„λ΅λ•μ…: SSL μ„¤μ • κ²€ν†  ν•„μ”

  2. ν™κ²½λ³€μ μ„¤μ •

  POSTGRES_CONNECTION_STRING=postgresql://user:password@ho    
  st:5432/database
  - Supabase ν¬λ§·: postgresql://postgres:password@db.xxx.s    
  upabase.co:5432/postgres β…
  - λ΅μ»¬ PostgreSQL ν¬λ§·:
  postgresql://localhost:5432/whattodo β…

  3. DNS ν•΄κ²° (IPv4 μ°μ„ )

  dns.setDefaultResultOrder('ipv4first');  //
  test-connection.js
  - ν„μ¬ ν…μ¤νΈ νμΌμ—λ§ μ μ©
  - κ¶μ¥: backend/index.js λ§¨ μ„μ—λ„ μ¶”κ°€
  const dns = require('dns');
  dns.setDefaultResultOrder('ipv4first');

  ---
  π”„ μ „ν™ μ‹λ‚λ¦¬μ¤

  λ΅μ»¬ PostgreSQL β†’ Supabase

  # .env νμΌλ§ λ³€κ²½
  POSTGRES_CONNECTION_STRING=postgresql://postgres:passwor    
  d@db.xxx.supabase.co:5432/postgres
  # μ½”λ“ λ³€κ²½ λ¶ν•„μ”!

  Supabase β†’ λ΅μ»¬ PostgreSQL

  # .env νμΌλ§ λ³€κ²½
  POSTGRES_CONNECTION_STRING=postgresql://localhost:5432/w    
  hattodo
  # μ½”λ“ λ³€κ²½ λ¶ν•„μ”!

  ---
  β¨ μµμΆ… κ¶μ¥μ‚¬ν•­

  1. μ§€κΈ μƒνƒ μ μ§€ κ°€λ¥: μ½”λ“λ” μ™„λ²½ν•κ² νΈν™
  2. κ°μ„  μ‚¬ν•­ (μ„ νƒ):
    - dns.setDefaultResultOrder('ipv4first') λ¥Ό index.js      
  μµμƒλ‹¨μ— μ¶”κ°€
    - ν”„λ΅λ•μ… SSL μ„¤μ • μ¬κ²€ν† 

  μ½”λ“ κ°μ„  μμ‹:

  // backend/index.js (μ²« μ¤„)
  const dns = require('dns');
  dns.setDefaultResultOrder('ipv4first');

  require('dotenv').config();
  const express = require('express');
  // ... λ‚λ¨Έμ§€ μ½”λ“

  κ²°λ΅ : β… ν„μ¬ μ½”λ“λ” PostgreSQLκ³Ό Supabase λ¨λ‘μ™€ 100%      
  νΈν™ κ°€λ¥ν•©λ‹λ‹¤. ν™κ²½λ³€μλ§ λ³€κ²½ν•λ©΄ μμ λ΅­κ² μ „ν™ν•  μ     
  μμµλ‹λ‹¤.